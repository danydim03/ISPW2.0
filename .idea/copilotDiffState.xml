<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/main/java/org/example/model/user/UserDAODB.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/org/example/model/user/UserDAODB.java" />
              <option name="originalContent" value="package org.example.model.user;&#10;&#10;import  org.example.enums.ExceptionMessagesEnum;&#10;import  org.example.enums.UserRoleEnum;&#10;import  org.example.exceptions.UserNotFoundException;&#10;import  org.example.exceptions.DAOException;&#10;import  org.example.exceptions.PropertyException;&#10;import  org.example.exceptions.ResourceNotFoundException;&#10;import  org.example.exceptions.UnrecognizedRoleException;&#10;import  org.example.exceptions.ObjectNotFoundException;&#10;import  org.example.exceptions.MissingAuthorizationException;&#10;import  org.example.exceptions.WrongDegreeCourseCodeException;&#10;import  org.example.exceptions.WrongListQueryIdentifierValue;&#10;&#10;import  org.example.instances_management_abstracts.DAODBAbstract;&#10;//import  org.example.model.role.Kebabbaro.ProfessorLazyFactory;&#10;//import  org.example.model.role.Amministratore.SecretaryLazyFactory;&#10;import  org.example.model.role.Cliente.StudentLazyFactory;&#10;&#10;&#10;import java.sql.Date;&#10;import java.sql.ResultSet;&#10;import java.sql.SQLException;&#10;import java.util.List;&#10;&#10;public class UserDAODB extends DAODBAbstract&lt;User&gt; implements UserDAOInterface  {&#10;    private static final   String EMAIL = &quot;email&quot;;&#10;    private static final  String CODICE_FISCALE = &quot;codice_fiscale&quot;;&#10;    protected static UserDAOInterface instance;&#10;&#10;    private UserDAODB() {&#10;        super();&#10;    }&#10;&#10;    public static synchronized UserDAOInterface getInstance() {&#10;        if (instance == null) {&#10;            instance = new UserDAODB();&#10;        }&#10;        return instance;&#10;    }&#10;&#10;    @Override&#10;    public User getUserByEmail(String email) throws UserNotFoundException, DAOException, PropertyException, ResourceNotFoundException, UnrecognizedRoleException, ObjectNotFoundException, MissingAuthorizationException, WrongDegreeCourseCodeException, WrongListQueryIdentifierValue {&#10;        return getQuery(&#10;                &quot;USER&quot;,&#10;                List.of(EMAIL),&#10;                List.of(email),&#10;                null&#10;        );&#10;    }&#10;&#10;    @Override&#10;    public User getUserByCodiceFiscale(String codiceFiscale) throws UserNotFoundException, DAOException, PropertyException, ResourceNotFoundException, UnrecognizedRoleException, ObjectNotFoundException, MissingAuthorizationException, WrongDegreeCourseCodeException, WrongListQueryIdentifierValue {&#10;        return getQuery(&#10;                &quot;USER&quot;,&#10;                List.of(CODICE_FISCALE),&#10;                List.of(codiceFiscale),&#10;                null&#10;        );&#10;    }&#10;&#10;&#10;&#10;&#10;    @Override&#10;    protected User queryObjectBuilder(ResultSet rs, List&lt;Object&gt; objects) throws SQLException, DAOException, PropertyException, ResourceNotFoundException, UnrecognizedRoleException, UserNotFoundException, ObjectNotFoundException, MissingAuthorizationException, WrongDegreeCourseCodeException, WrongListQueryIdentifierValue {&#10;        User user = new User(&#10;                rs.getString(&quot;name&quot;),&#10;                rs.getString(&quot;surname&quot;),&#10;                rs.getString(CODICE_FISCALE),&#10;                rs.getString(EMAIL),&#10;                rs.getString(&quot;password&quot;),&#10;                rs.getDate(&quot;registration_date&quot;).toLocalDate()&#10;        );&#10;        setUserRoleByRoleEnum(user,UserRoleEnum.getUserRoleByType(rs.getInt(&quot;role&quot;)));&#10;        return user;&#10;    }&#10;&#10;    @Override&#10;    protected String setGetListQueryIdentifiersValue(User user, int valueNumber) throws DAOException {&#10;        return null;&#10;    }&#10;&#10;    @Override&#10;    public void insert(User user) throws DAOException, PropertyException, ResourceNotFoundException, MissingAuthorizationException {&#10;        insertQuery(&#10;                &quot;USER&quot;,&#10;                List.of(user.getCodiceFiscale(), user.getName(), user.getSurname(), user.getPassword(), Date.valueOf(user.getRegistrationDate()), user.getEmail(),user.getRole().getRoleEnumType().type)&#10;        );&#10;    }&#10;&#10;    @Override&#10;    public void delete(User user) throws DAOException, PropertyException, ResourceNotFoundException {&#10;        deleteQuery(&#10;                &quot;USER&quot;,&#10;                List.of(CODICE_FISCALE),&#10;                List.of(user.getCodiceFiscale())&#10;        );&#10;    }&#10;&#10;    @Override&#10;    public void update(User user) throws PropertyException, ResourceNotFoundException, DAOException, MissingAuthorizationException {&#10;        updateQuery(&#10;                &quot;USER&quot;,&#10;                List.of( &quot;name&quot;, &quot;surname&quot;, &quot;password&quot;, &quot;registration_date&quot;, EMAIL, &quot;role&quot;),&#10;                List.of(user.getName(),user.getSurname(),user.getPassword(),Date.valueOf(user.getRegistrationDate()),user.getEmail(),user.getRole().getRoleEnumType().type),&#10;                List.of(CODICE_FISCALE),&#10;                List.of(user.getCodiceFiscale()));&#10;    }&#10;&#10;    /**&#10;     * Set the user role by a given role value&#10;     *&#10;     * @param user the User whose role has to be set&#10;     * @param role the role to be set ot the User&#10;     * @throws UnrecognizedRoleException thrown if the role value cannot be cast to any enum value&#10;     * @throws DAOException              thrown if errors occur while retrieving data from persistence layer&#10;     * @throws UserNotFoundException     thrown if the given User cannot be found&#10;     */&#10;    protected void setUserRoleByRoleEnum(User user, UserRoleEnum role) throws UnrecognizedRoleException, DAOException, UserNotFoundException, ObjectNotFoundException, MissingAuthorizationException, WrongDegreeCourseCodeException, WrongListQueryIdentifierValue {&#10;        switch (role) {&#10;            case STUDENT -&gt; user.setRole(StudentLazyFactory.getInstance().getStudentByUser(user));&#10;            case PROFESSOR -&gt; user.setRole(ProfessorLazyFactory.getInstance().getProfessorByUser(user));&#10;            case SECRETARY -&gt; user.setRole(SecretaryLazyFactory.getInstance().getSecretaryByUser(user));&#10;            default -&gt; throw new UnrecognizedRoleException(ExceptionMessagesEnum.UNRECOGNIZED_ROLE.message);&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package org.example.model.user;&#10;&#10;import  org.example.enums.ExceptionMessagesEnum;&#10;import  org.example.enums.UserRoleEnum;&#10;import  org.example.exceptions.UserNotFoundException;&#10;import  org.example.exceptions.DAOException;&#10;import  org.example.exceptions.PropertyException;&#10;import  org.example.exceptions.ResourceNotFoundException;&#10;import  org.example.exceptions.UnrecognizedRoleException;&#10;import  org.example.exceptions.ObjectNotFoundException;&#10;import  org.example.exceptions.MissingAuthorizationException;&#10;import  org.example.exceptions.WrongDegreeCourseCodeException;&#10;import  org.example.exceptions.WrongListQueryIdentifierValue;&#10;&#10;import  org.example.instances_management_abstracts.DAODBAbstract;&#10;//import  org.example.model.role.Kebabbaro.ProfessorLazyFactory;&#10;//import  org.example.model.role.Amministratore.SecretaryLazyFactory;&#10;import  org.example.model.role.Cliente.StudentLazyFactory;&#10;&#10;&#10;import java.sql.Date;&#10;import java.sql.ResultSet;&#10;import java.sql.SQLException;&#10;import java.util.List;&#10;&#10;public class UserDAODB extends DAODBAbstract&lt;User&gt; implements UserDAOInterface  {&#10;    private static final   String EMAIL = &quot;email&quot;;&#10;    private static final  String CODICE_FISCALE = &quot;codice_fiscale&quot;;&#10;    protected static UserDAOInterface instance;&#10;&#10;    private UserDAODB() {&#10;        super();&#10;    }&#10;&#10;    public static synchronized UserDAOInterface getInstance() {&#10;        if (instance == null) {&#10;            instance = new UserDAODB();&#10;        }&#10;        return instance;&#10;    }&#10;&#10;    @Override&#10;    public User getUserByEmail(String email) throws UserNotFoundException, DAOException, PropertyException, ResourceNotFoundException, UnrecognizedRoleException, ObjectNotFoundException, MissingAuthorizationException, WrongDegreeCourseCodeException, WrongListQueryIdentifierValue {&#10;        return getQuery(&#10;                &quot;USER&quot;,&#10;                List.of(EMAIL),&#10;                List.of(email),&#10;                null&#10;        );&#10;    }&#10;&#10;    @Override&#10;    public User getUserByCodiceFiscale(String codiceFiscale) throws UserNotFoundException, DAOException, PropertyException, ResourceNotFoundException, UnrecognizedRoleException, ObjectNotFoundException, MissingAuthorizationException, WrongDegreeCourseCodeException, WrongListQueryIdentifierValue {&#10;        return getQuery(&#10;                &quot;USER&quot;,&#10;                List.of(CODICE_FISCALE),&#10;                List.of(codiceFiscale),&#10;                null&#10;        );&#10;    }&#10;&#10;&#10;&#10;&#10;    @Override&#10;    protected User queryObjectBuilder(ResultSet rs, List&lt;Object&gt; objects) throws SQLException, DAOException, PropertyException, ResourceNotFoundException, UnrecognizedRoleException, UserNotFoundException, ObjectNotFoundException, MissingAuthorizationException, WrongDegreeCourseCodeException, WrongListQueryIdentifierValue {&#10;        User user = new User(&#10;                rs.getString(&quot;name&quot;),&#10;                rs.getString(&quot;surname&quot;),&#10;                rs.getString(CODICE_FISCALE),&#10;                rs.getString(EMAIL),&#10;                rs.getString(&quot;password&quot;),&#10;                rs.getDate(&quot;registration_date&quot;).toLocalDate()&#10;        );&#10;        setUserRoleByRoleEnum(user,UserRoleEnum.getUserRoleByType(rs.getInt(&quot;role&quot;)));&#10;        return user;&#10;    }&#10;&#10;    @Override&#10;    protected String setGetListQueryIdentifiersValue(User user, int valueNumber) throws DAOException {&#10;        return null;&#10;    }&#10;&#10;    @Override&#10;    public void insert(User user) throws DAOException, PropertyException, ResourceNotFoundException, MissingAuthorizationException {&#10;        insertQuery(&#10;                &quot;USER&quot;,&#10;                List.of(user.getCodiceFiscale(), user.getName(), user.getSurname(), user.getPassword(), Date.valueOf(user.getRegistrationDate()), user.getEmail(),user.getRole().getRoleEnumType().type)&#10;        );&#10;    }&#10;&#10;    @Override&#10;    public void delete(User user) throws DAOException, PropertyException, ResourceNotFoundException {&#10;        deleteQuery(&#10;                &quot;USER&quot;,&#10;                List.of(CODICE_FISCALE),&#10;                List.of(user.getCodiceFiscale())&#10;        );&#10;    }&#10;&#10;    @Override&#10;    public void update(User user) throws PropertyException, ResourceNotFoundException, DAOException, MissingAuthorizationException {&#10;        updateQuery(&#10;                &quot;USER&quot;,&#10;                List.of( &quot;name&quot;, &quot;surname&quot;, &quot;password&quot;, &quot;registration_date&quot;, EMAIL, &quot;role&quot;),&#10;                List.of(user.getName(),user.getSurname(),user.getPassword(),Date.valueOf(user.getRegistrationDate()),user.getEmail(),user.getRole().getRoleEnumType().type),&#10;                List.of(CODICE_FISCALE),&#10;                List.of(user.getCodiceFiscale()));&#10;    }&#10;&#10;    /**&#10;     * Set the user role by a given role value&#10;     *&#10;     * @param user the User whose role has to be set&#10;     * @param role the role to be set ot the User&#10;     * @throws UnrecognizedRoleException thrown if the role value cannot be cast to any enum value&#10;     * @throws DAOException              thrown if errors occur while retrieving data from persistence layer&#10;     * @throws UserNotFoundException     thrown if the given User cannot be found&#10;     */&#10;    protected void setUserRoleByRoleEnum(User user, UserRoleEnum role) throws UnrecognizedRoleException, DAOException, UserNotFoundException, ObjectNotFoundException, MissingAuthorizationException, WrongDegreeCourseCodeException, WrongListQueryIdentifierValue {&#10;        switch (role) {&#10;            case STUDENT -&gt; user.setRole(StudentLazyFactory.getInstance().getStudentByUser(user));&#10;            case PROFESSOR -&gt; user.setRole(ProfessorLazyFactory.getInstance().getProfessorByUser(user));&#10;            case SECRETARY -&gt; user.setRole(SecretaryLazyFactory.getInstance().getSecretaryByUser(user));&#10;            default -&gt; throw new UnrecognizedRoleException(ExceptionMessagesEnum.UNRECOGNIZED_ROLE.message);&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/org/example/use_cases/login/LoginControl.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/org/example/use_cases/login/LoginControl.java" />
              <option name="originalContent" value="package org.example.use_cases.login;&#10;&#10;import org.example.beans_general.LoginBean;&#10;import org.example.beans_general.UserBean;&#10;import org.example.enums.ExceptionMessagesEnum;&#10;import org.example.exceptions.*;&#10;import org.example.model.user.User;&#10;import org.example.model.user.UserLazyFactory;&#10;import org.example.session_manager.SessionManager;&#10;&#10;import java.util.regex.Matcher;&#10;import java.util.regex.Pattern;&#10;&#10;public class LoginControl {&#10;    public LoginBean login(String email, String password) throws UserNotFoundException, WrongPasswordException, DAOException, MissingAuthorizationException, PropertyException, ResourceNotFoundException, UnrecognizedRoleException, WrongListQueryIdentifierValue, ObjectNotFoundException, WrongDegreeCourseCodeException {&#10;        User user = UserLazyFactory.getInstance().getUserByEmail(email);&#10;        user.checkPassword(password);&#10;        String matricola;&#10;        switch (user.getRole().getRoleEnumType()) {&#10;            case STUDENT -&gt; matricola = user.getRole().getStudentRole().getMatricola();&#10;            case PROFESSOR -&gt; matricola = user.getRole().getProfessorRole().getMatricola();&#10;            default -&gt; matricola = &quot;&quot;;&#10;        }&#10;        return new LoginBean(&#10;                SessionManager.getInstance().getSessionTokenKeyByUser(user),&#10;                new UserBean(&#10;                        user.getName(),&#10;                        user.getSurname(),&#10;                        user.getCodiceFiscale(),&#10;                        user.getEmail(),&#10;                        user.getRole().getRoleEnumType(),&#10;                        matricola&#10;                )&#10;        );&#10;    }&#10;&#10;    public void emailMatches(String email) throws EmailFormatException {&#10;        final Pattern emailPattern = Pattern.compile(&quot;^(?=.{1,64}@)[A-Za-z0-9_-]+(\\.[A-Za-z0-9_-]+){0,63}@[^-][A-Za-z0-9-]+(\\.[A-Za-z0-9-]+){0,63}(\\.[A-Za-z]{2,})&quot;);&#10;        final Matcher emailMatcher = emailPattern.matcher(email);&#10;        if (!emailMatcher.matches())&#10;            throw new EmailFormatException(ExceptionMessagesEnum.EMAIL_FORMAT.message);&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package org.example.use_cases.login;&#10;&#10;import org.example.beans_general.LoginBean;&#10;import org.example.beans_general.UserBean;&#10;import org.example.enums.ExceptionMessagesEnum;&#10;import org.example.exceptions.*;&#10;import org.example.model.user.User;&#10;import org.example.model.user.UserLazyFactory;&#10;import org.example.session_manager.SessionManager;&#10;&#10;import java.util.regex.Matcher;&#10;import java.util.regex.Pattern;&#10;&#10;public class LoginControl {&#10;    public LoginBean login(String email, String password) throws UserNotFoundException, WrongPasswordException, DAOException, MissingAuthorizationException, PropertyException, ResourceNotFoundException, UnrecognizedRoleException, WrongListQueryIdentifierValue, ObjectNotFoundException, WrongDegreeCourseCodeException {&#10;        User user = UserLazyFactory.getInstance().getUserByEmail(email);&#10;        user.checkPassword(password);&#10;        String matricola;&#10;        switch (user.getRole().getRoleEnumType()) {&#10;            case STUDENT -&gt; matricola = user.getRole().getStudentRole().getMatricola();&#10;            case PROFESSOR -&gt; matricola = user.getRole().getProfessorRole().getMatricola();&#10;            default -&gt; matricola = &quot;&quot;;&#10;        }&#10;        return new LoginBean(&#10;                SessionManager.getInstance().getSessionTokenKeyByUser(user),&#10;                new UserBean(&#10;                        user.getName(),&#10;                        user.getSurname(),&#10;                        user.getCodiceFiscale(),&#10;                        user.getEmail(),&#10;                        user.getRole().getRoleEnumType(),&#10;                        matricola&#10;                )&#10;        );&#10;    }&#10;&#10;    public void emailMatches(String email) throws EmailFormatException {&#10;        final Pattern emailPattern = Pattern.compile(&quot;^(?=.{1,64}@)[A-Za-z0-9_-]+(\\.[A-Za-z0-9_-]+){0,63}@[^-][A-Za-z0-9-]+(\\.[A-Za-z0-9-]+){0,63}(\\.[A-Za-z]{2,})&quot;);&#10;        final Matcher emailMatcher = emailPattern.matcher(email);&#10;        if (!emailMatcher.matches())&#10;            throw new EmailFormatException(ExceptionMessagesEnum.EMAIL_FORMAT.message);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>